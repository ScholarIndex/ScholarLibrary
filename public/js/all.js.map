{"version":3,"sources":["app.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["\r\n$.expr[\":\"].contains = $.expr.createPseudo(function(arg) {\r\n    return function( elem ) {\r\n        return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;\r\n    };\r\n});\r\n\r\nvar LBC = {\r\n\r\n\tinit : function(){\r\n\t\r\n\t\tvar datajs = $('body').attr('data-js');\r\n\t\tif(datajs !== \"\"){\t\r\n\t\t\twindow[datajs].init();\r\n\t\t}\r\n\r\n\t\t$(document).on('click', '.fa.fa-question-circle', function(){$('#helpwrapper').fadeToggle();});\r\n\r\n\t\tif($('body').attr('data-documentid') !== \"\"){\r\n\t\t\t$.ajax({\r\n\t\t        url: \"/document/progress/\"+$('body').attr('data-documentid'),\r\n\t\t        type: \"GET\",\r\n\t\t        dataType: \"html\",\r\n\t\t        success: function (data) {\r\n\t\t            $('.progress').html(data);\r\n\t\t        }\r\n\t\t    });\t\t\t\t\r\n\t\t}\t \r\n\r\n\r\n\t}\r\n\t\r\n\t\r\n\t\r\n};\r\n\r\nvar ARTICLEOVERVIEW = {\r\n\tinit : function(){}\r\n};\r\n\r\nvar OVERVIEW = {\r\n\tinit : function(){\r\n\t}\r\n};\r\n\r\nvar SCANS = {\r\n\tinit : function(){\r\n\t}\r\n};\r\n\r\n\r\nvar VIEWER = {\r\n\tinit : function(){\r\n\t\t\r\n\t\tVIEWER.loadPage();\r\n\t\t\r\n\t\t$( window ).hashchange(VIEWER.loadPage);\r\n\t\t\r\n\t\t$(document).keydown(function(e) {\r\n\t\t\tvar n = parseInt(location.hash.replace('#',''),10);\r\n\t\t\tif(isNaN(n)) n = 1;\r\n\r\n\t\t\tmax = parseInt($('.filmstrip .thumb:last').attr('data-n'),10);\r\n\t\t    switch(e.which) {\r\n\t\t        case 37: // left\r\n\t\t\t\tif(n > 1)\r\n\t\t\t\t\tlocation.hash = n-1;\t\r\n\t\t        break;\r\n\t\t\t\t\t\r\n\t\t        case 39: // right\r\n\t\t\t\tif(n < max)\r\n\t\t\t\t\tlocation.hash = n+1;\r\n\t\t        break;\r\n\t\t\r\n\t\t\r\n\t\t        default: return; // exit this handler for other keys\r\n\t\t    }\r\n\t\t    e.preventDefault(); // prevent the default action (scroll / move caret)\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t}, \r\n\t\r\n\tloadPage : function(){\r\n\t\tvar n = location.hash.replace('#','');\r\n\t\tif(n == \"\") n=1;\r\n\t\t\t\t\r\n\t\tbid = $('body').attr('data-bid');\r\n\t\tissue = $('body').attr('data-issue');\r\n\t\t\r\n\t\tvar cat = ($('body').attr('data-type') == 'monograph') ? 'books' : 'journals';\r\n\t\tbid = ($('body').attr('data-type') == 'monograph') ? $('body').attr('data-provenance')+\"_\"+bid : bid;\r\n\t\t$('#pageview').html('');\r\n\t\tvar viewer = OpenSeadragon({\r\n\t    \tid: 'pageview',\r\n\t   \t \tprefixUrl: \"/i/openseadragon/\",\r\n\t    \ttileSources: $('#pageview').attr('data-baseuri')+\"::\"+n+\"/info.json\",\r\n\t    \tzoomPerScroll: 1.5,\r\n\t    \tshowNavigationControl: false,\r\n\t    \timmediateRender: true\r\n\t\t});\t\t\t\r\n\t\t\r\n\t\t$.ajax({\r\n\t        url: \"/document/page/text/\"+$('.thumb[data-n='+n+']').attr('data-oid'),\r\n\t        type: \"GET\",\r\n\t        dataType: \"html\",\r\n\t        success: function (data) {\r\n\t            $('#textview').html(data);\r\n\t        }\r\n\t    });\t\t\t\t\r\n\t\t\t\r\n\t\t$('.thumb').removeClass('active');\r\n\t\t$('.thumb[data-n='+n+']').addClass('active');\r\n\t\t$('.filmstrip').scrollTo($('.thumb.active'),200, {offset : {left: -$('.filmstrip').width()/2+100}});\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n};\r\n\r\nvar JOURNAL = {\r\n\r\n\tinit : function(){\r\n\t\t$(document).on('click', '.button', function(){\r\n\t\t\tdocument.location = '/document/overview/'+$('body').attr('data-bid')+'/'+$('select').val()\r\n\t\t});\r\n\t},\r\n\r\n};\r\n\r\nvar SEARCH = {\r\n\t\r\n\tpage : null,\r\n\t\r\n\tinit : function(){\r\n\t\t\r\n\t\tSEARCH.page = $('.noPage').text();\r\n\t\t\r\n\t\t$(document).on('click', '.chk', function(e){\r\n\t\t\t$(this).toggleClass('checked');\r\n\t\t\tSEARCH.page = 1;\r\n\t\t\tSEARCH.doSearch();\r\n\t\t});\r\n\t\t\r\n\t\t$(document).on('click', '.allfilters.unselect', function(){\r\n        \t$(this).closest('ul').find('li').removeClass('checked');\r\n\t\t\tSEARCH.page = 1;\r\n\t\t\tSEARCH.doSearch();\r\n        });\r\n        $(document).on('click', '.allfilters.select', function(){\r\n        \t$(this).closest('ul').find('li').addClass('checked');\r\n\t\t\tSEARCH.page = 1;\r\n\t\t\tSEARCH.doSearch(); \r\n        });\r\n\t\t\r\n\t\t$(document).on('click', '.sub', function(e){\r\n\t\t\tif(e.target != this) return;\r\n\t\t\t$(this).toggleClass('open');\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\t$(document).on('click', '.countersbar li.docs', function () {\r\n\t\t\t$('.countersbar li.cat').removeClass('disabled');\r\n\t\t\tSEARCH.page = 1;\r\n\t\t\tSEARCH.doSearch();\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\t$(document).on('click', '.countersbar li.cat', function () {\r\n\t\t\tif( $(this).hasClass('disabled') || $('.countersbar li.cat.disabled').length==0){\r\n\t\t\t\t$('.countersbar li.cat').addClass('disabled');\r\n\t\t\t\t$(this).removeClass('disabled');\r\n\t\t\t\tSEARCH.page = 1;\r\n\t\t\t\tSEARCH.doSearch();\r\n\t\t\t}else{\r\n\t\t\t\t$('.countersbar li.cat').removeClass('disabled');\r\n\t\t\t\tSEARCH.page = 1;\r\n\t\t\t\tSEARCH.doSearch();\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t$(document).on('click', '.card', function(e){\r\n\t\t\tif($(this).hasClass('journal')) return;\r\n\t\t\t\r\n\t\t\tif($(this).hasClass('article'))\r\n\t\t\t\tdocument.location = '/article/overview/'+$(this).attr('data-oid');\r\n\t\t\t\r\n\t\t\tif($(this).attr('data-bid') != \"\")\r\n\t\t\t\tdocument.location = '/document/overview/'+$(this).attr('data-bid');\r\n\t\t});\r\n\t\t\r\n\t\t$(document).on('click', '.fa-arrow-circle-o-right', function(){\r\n\t\t\tif($(this).closest('.card').attr('data-bid') != \"\")\r\n\t\t\t\tdocument.location = '/document/overview/'+$(this).closest('.card').attr('data-bid')+'/'+$(this).closest('.card').find('select').val();\r\n\t\t\t\r\n\t\t});\r\n\t\t\r\n\t\r\n        $(document).on('keyup','#search input', function(e){\r\n            var code = e.keyCode || e.which;\r\n             if(code == 13) { //Enter keycode\r\n             \tSEARCH.doSearch();\r\n             }\r\n        });\r\n\t\t\r\n\t\t$(document).on('click', '.fa-angle-left', function(){\r\n\t\t\tSEARCH.page--;\t\t\r\n\t\t\tSEARCH.doSearch();\t\r\n\t\t});\t\t\r\n\r\n\t\t$(document).on('click', '.fa-angle-right', function(){\r\n\t\t\tSEARCH.page++;\t\t\r\n\t\t\tSEARCH.doSearch();\t\r\n\t\t});\t\t\r\n\r\n\t\t \r\n\t\tSEARCH.doSearch();\r\n\t},\r\n\t\r\n\trefreshFilters : function(){\r\n\r\n\t\tvar filtrs = {};\t\r\n\t\t$('.sub').each(function(){\r\n\t\t\tvar sub = $(this);\r\n\t\t\tfiltrs[sub.attr('data-field')] = [];\r\n\t\t\t\r\n\t\t\t$(this).find('li.checked').each(function(){\r\n\t\t\t\tfiltrs[sub.attr('data-field')].push($(this).attr('data-key'));\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.sub').each(function(){\r\n\t\t\tvar sub = $(this);\r\n\t\t\t$.ajax({\r\n\t\t        url: \"/filters\",\r\n\t\t        type: \"POST\",\r\n\t\t        data: {\r\n\t\t        \t'q': $('#search input').val(),\r\n\t\t        \t'ns': $.map($('.countersbar li.cat:not(.disabled)'), function(a) { return $(a).attr(\"data-ns\");}),\r\n\t\t        \t'in' : {\r\n\t\t        \t\t'authors' : $('.filters .chk.authors').hasClass('checked'),\r\n\t\t        \t\t'titles' : $('.filters .chk.titles').hasClass('checked'), \r\n\t\t        \t\t'publishers' : $('.filters .chk.publishers').hasClass('checked'),\t\r\n\t\t        \t},\r\n\t\t        \t'field' : sub.attr('data-field'),\r\n\t\t        \t'filtrs' : filtrs,\r\n\t\t        \t\t\t\r\n\t\r\n\t\t        },\r\n\t\t        dataType: \"html\",\r\n\t\t        success: function (data) {\r\n\t\t        \tsub.find('ul').html(data);\r\n\t\t\t\t}\r\n\t\t\t});\t\t\r\n\t\t});\r\n\t},\r\n\t\r\n\tdoSearch : function(){\r\n\t\t\r\n\t\tSEARCH.refreshFilters();\r\n\t\t\r\n\t\tvar filtrs = {};\t\r\n\t\t$('.sub').each(function(){\r\n\t\t\tvar sub = $(this);\r\n\t\t\tfiltrs[sub.attr('data-field')] = [];\r\n\t\t\t\r\n\t\t\t$(this).find('li.checked').each(function(){\r\n\t\t\t\tfiltrs[sub.attr('data-field')].push($(this).attr('data-key'));\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$.ajax({\r\n\t        url: \"/count\",\r\n\t        type: \"POST\",\r\n\t        data: {\r\n\t        \t'q': $('#search input').val(),\r\n\t        \t'page' : SEARCH.page,\r\n\t        \t'in' : {\r\n\t        \t\t'authors' : $('.filters .chk.authors').hasClass('checked'),\r\n\t        \t\t'titles' : $('.filters .chk.titles').hasClass('checked'), \r\n\t        \t\t'publishers' : $('.filters .chk.publishers').hasClass('checked'),\t\r\n\t        \t},\r\n\t        \t'filtrs' : filtrs \r\n\t        },\r\n\t        dataType: \"json\",\r\n\t        success: function (data) {\r\n\t        \t$('.docs span').html(data.response.response.numFound);\t\r\n\t        \t$('.cat.monograph span').html(data.response.facet_counts.facet_fields.ns[_SOLR_ROOT_+'.bibliodb_books']);\r\n\t        \t$('.cat.article span').html(data.response.facet_counts.facet_fields.ns[_SOLR_ROOT_+'.bibliodb_articles']);\r\n\t        \t$('.cat.journal span').html(data.response.facet_counts.facet_fields.ns[_SOLR_ROOT_+'.bibliodb_journals']);\r\n\t\t\t\t$('.cat.contribution span').html(0);\r\n\t        }\r\n\t    });\t\r\n\r\n\t\t\r\n\t\t$.ajax({\r\n\t        url: \"/search\",\r\n\t        type: \"POST\",\r\n\t        data: {\r\n\t        \t'q': $('#search input').val(),\r\n\t        \t'ns': $.map($('.countersbar li.cat:not(.disabled)'), function(a) { return $(a).attr(\"data-ns\");}),\r\n\t        \t'page' : SEARCH.page,\r\n\t        \t'in' : {\r\n\t        \t\t'authors' : $('.filters .chk.authors').hasClass('checked'),\r\n\t        \t\t'titles' : $('.filters .chk.titles').hasClass('checked'), \r\n\t        \t\t'publishers' : $('.filters .chk.publishers').hasClass('checked'),\t\r\n\t        \t},\r\n\t        \t'filtrs' : filtrs \r\n\t        },\r\n\t        dataType: \"json\",\r\n\t        success: function (data) {\r\n\t        \tnbPages = Math.ceil(data.response.response.numFound / 12);\r\n\t        \t$('.docs span').html(data.response.response.numFound);\r\n\t        \t$('span.noPage').html(SEARCH.page);\r\n\t        \t$('span.nbPage').html(nbPages);\r\n\t        \tif(SEARCH.page == 1)\r\n\t        \t\t$('.fa-angle-left').hide();\r\n\t        \telse\r\n\t        \t\t$('.fa-angle-left').show();\r\n\t        \t\r\n\t        \tif(SEARCH.page == nbPages)\r\n\t        \t\t$('.fa-angle-right').hide();\r\n\t        \telse\r\n\t        \t\t$('.fa-angle-right').show();\r\n\t        \t\r\n\t\t\t\t$('div.results').html('');\r\n\t\t\t\tfor(var res in data.results){\r\n\t\t\t\t\tSEARCH.result.object = data.results[res];\r\n\t\t\t\t\t\r\n\t\t\t\t\tdiv = $('<div class=\"card '+SEARCH.result.getClass()+'\" data-oid=\"'+SEARCH.result.getOID()+'\" data-bid=\"'+SEARCH.result.getBid()+'\"></div>');\r\n\t\t\t\t\tdiv.append('<p>'+SEARCH.result.getType()+'</p>');\r\n\t\t\t\t\tdiv.append('<p>'+SEARCH.result.getTitle()+'</p>');\r\n\t\t\t\t\tdiv.append('<p>'+SEARCH.result.getAuthor()+'</p>');\r\n\t\t\t\t\tdiv.append('<p>'+SEARCH.result.getDate()+'</p>');\r\n\t\t\t\t\tdiv.append('<p>'+SEARCH.result.getVolume()+'</p>');\r\n\t\t\t\t\tdiv.append('<p>'+SEARCH.result.getTitleOfJournal()+'</p>');\r\n\t\t\t\t\t$('div.results').append(div);\t\r\n\t\t\t\t}\r\n\t        }\r\n\t    });\t\r\n\r\n\t},\r\n\t\r\n\r\n\t\r\n\tresult : { \r\n\t\tobject : null,\r\n\t\t\r\n\t\tgetOID : function(){\r\n\t\t\treturn this.object['_id'];\r\n\t\t},\r\n\t\t\r\n\t\tgetBid : function(){\r\n\t\t\treturn this.object['bid'] || '';\t\r\n\t\t},\r\n\t\t\r\n\t\tgetClass : function(){\r\n\t\t\treturn this.object['_type_'];\r\n\t\t},\r\n\t\t\r\n\t\tgetType : function(){\r\n\t\t\tswitch(this.object['_type_']){\r\n\t\t\t\tcase 'monograph': return 'Book';  break;\r\n\t\t\t\tcase 'article': return 'Article';  break;\r\n\t\t\t\tcase 'journal': return 'Journal '+SEARCH.result.getIssues();  break;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t},\r\n\t\t\r\n\t\tgetIssues : function(){\r\n\t\t\tvar options = \"<option>search issue</option>\";\r\n\t\t\tvar n = 0;\r\n\t\t\tfor(var issue in SEARCH.result.object._meta_.issues){\t\t\t\r\n\t\t\t\tvar is = SEARCH.result.object._meta_.issues[issue];\r\n\t\t\t\tif(is.marked_as_removed == false){\r\n\t\t\t\t\toptions += \"<option value='\"+is.foldername+\"'>\"+is.foldername+\"</option>\";\r\n\t\t\t\t\tn++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn '<span>'+n+' Issues <select>'+options+'</select> <i class=\"fa fa-arrow-circle-o-right\"></i></span>';\r\n\t\t},\r\n\t\t\r\n\t\tgetTitle : function(){\r\n\t\t\tswitch(this.object['_type_']){\r\n\t\t\t\tcase 'monograph': return this.object.title || '';  break;\r\n\t\t\t\tcase 'article': return this.object.title || '';  break;\r\n\t\t\t\tcase 'journal': return '<a href=\"/document/journal/'+this.object.bid+'\">'+this.object.full_title+'</a>' || '';  break;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tgetAuthor : function(){\r\n\t\t\tswitch(this.object['_type_']){\r\n\t\t\t\tcase 'monograph': return this.object.author || '';  break;\r\n\t\t\t\tcase 'article': return this.object.authors[0] || '';  break;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t},\r\n\t\tgetVolume : function(){\r\n\t\t\tswitch(this.object['_type_']){\r\n\t\t\t\tcase 'article': return 'Volume : '+this.object.volume || '';  break;\r\n\t\t\t}\r\n\t\t\treturn '';\t\r\n\t\t},\r\n\t\tgetDate : function(){\r\n\t\t\tswitch(this.object['_type_']){\r\n\t\t\t\tcase 'monograph': return this.object.publication_year || '' ;  break;\r\n\t\t\t\tcase 'journal': \r\n\t\t\t\t\tvar min = 9999;\r\n\t\t\t\t\tvar max = 0;\r\n\t\t\t\t\tfor(var issue in SEARCH.result.object._meta_.issues){\t\t\t\r\n\t\t\t\t\t\tvar is = SEARCH.result.object._meta_.issues[issue];\r\n\t\t\t\t\t\tif(is.year < min) min = is.year;\r\n\t\t\t\t\t\tif(is.year > max) max = is.year;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn 'From '+min+' to '+max;  \r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'article': return this.object.year || ''; break;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t},\r\n\t\tgetTitleOfJournal : function(){\r\n\t\t\tswitch(this.object['_type_']){\r\n\t\t\t\tcase 'article': return this.object._journal_.short_title || '';  break;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t},\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n};\r\n\r\nvar REF = {\r\n\tallRefs : [],\r\n\t\r\n\thighlight : function(){\r\n\t\t\r\n\t\tvar q = $('#textSearch input').val();\r\n\t\t\r\n\t\t\t\t\r\n\t\t$('.fulltext').unmark({\r\n      \t\tdone: function() {\r\n\t        \t$('.fulltext').mark(q, {\r\n\t          \t\tseparateWordSearch: true,\r\n\t          \t\taccuracy:'complementary'\r\n\t        \t});\r\n      \t\t}\r\n    \t});\r\n\t\r\n\t\t\r\n\t},\r\n\t\r\n\tloadPage : function(div){\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t    \tbeforeSend : function(){\r\n\t\t    \t\tdiv.removeClass('notLoaded');\r\n\t\t    \t},\r\n\t\t        url: \"/document/page/text/\"+div.attr('data-oid'),\r\n\t\t        type: \"GET\",\r\n\t\t        dataType: \"html\",\r\n\t\t        success: function (data) {\r\n\t\t            div.html(data);\r\n\t\t\t\t\tREF.highlight();\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t        url: \"/document/page/references/\"+div.attr('data-oid')+\"/\"+$('body').attr('data-bid')+\"/\"+$('body').attr('data-issue'),\r\n\t\t\t\t        type: \"GET\",\r\n\t\t\t\t        dataType: \"json\",\r\n\t\t\t\t        success: function (data) {\r\n\t\t\t\t\t\t\tfor(var ref in data){\r\n\t\t\t\t            \tvar token = data[ref]['contents'][1];\r\n\t\t\t\t\t\t\t\tdiv.find('span[_st='+token['start']+']').after('<em data-ref=\"'+ref+'\" class=\"'+data[ref]['ref_type']+'\"></em>');\r\n\t\t\t\t\t\t\t\tREF.allRefs[ref] = data[ref];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar heights = [];\r\n\t\t\t\t\t\t\tdiv.find('em').each(function(){\r\n\t\t\t\t\t\t\t\tif(heights[$(this).position().top] == undefined){\r\n\t\t\t\t\t\t\t\t\theights[$(this).position().top] = 0;\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\theights[$(this).position().top] += 1;\r\n\t\t\t\t\t\t\t\t\t$(this).addClass('x'+heights[$(this).position().top]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t        }\r\n\t\t\t\t    });\t\r\n\t\t\t\t\t\t            \r\n\t\t            \r\n\t\t        }\r\n\t\t    });\t\r\n\t\t\r\n\t},\r\n\t\r\n\tinit : function(){\r\n\t\t$(document).on('mouseenter','div.notLoaded' ,function(){\r\n\t\t\tvar div = $(this);\r\n\t\t\tREF.loadPage(div);\r\n\t\t});\r\n\t\t\r\n\t\t$('div.notLoaded:lt(5)').each(function(){\r\n\t\t\tdiv = $(this);\r\n\t\t\tREF.loadPage(div);\r\n\t\t});\r\n\t\t\r\n\t\t$(document).on('click', 'a.pn', function(){\r\n\t\t\tdocument.location.href = document.location.href.replace('references','viewer')+\"#\"+$(this).text(); \r\n\t\t});\r\n\t\t\r\n\t\t$(document).on('click', 'em', function(){\r\n\t\t\t$('em').removeClass('active');\r\n\t\t\t$('span').removeClass('hl');\r\n\t\t\t$(this).addClass('active');\r\n\t\t\tvar div = $(this).closest('div.page');\r\n\t\t\tvar ref = $(this).attr('data-ref');\r\n\t\t\t\r\n\t\t\t$.ajax({\r\n\t\t        url: \"/document/page/reference/\"+ref,\r\n\t\t        type: \"GET\",\r\n\t\t        dataType: \"html\",\r\n\t\t        success: function (data) {\r\n\t\t            $('.refDetails').html(data);\r\n\t\t        }\r\n\t\t    });\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tvar contents = REF.allRefs[ref]['contents'];\r\n\t\t \tfor(var content in contents){\r\n\t\t\t\tvar token = contents[content];\r\n\t\t\t\tdiv.find('span').filter(function(){\r\n\t\t\t\t\treturn $(this).attr('_st') >= token['start'] && $(this).attr('_en') <= token['end'];\r\n\t\t\t\t}).addClass('hl');\r\n\t        }\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t});\t\t\r\n\t\t\r\n\t\t$(document).on('keyup', '#textSearch input', function(){\r\n\t\t\tvar input = $(this);\r\n\t\t\tif(input.val().length >= 3){\r\n\t\t\t\t$.ajax({\r\n\t\t\t        url: \"/document/page/references/textsearch\",\r\n\t\t\t        type: \"POST\",\r\n\t\t\t        dataType: \"json\",\r\n\t\t\t        data : {\r\n\t\t\t        \tdocument_id : $('body').attr('data-documentid'),\r\n\t\t\t        \tsearch : input.val()\r\n\t\t\t        },\r\n\t\t\t        success: function (data) {\r\n\t\t\t        \t$('.separator').remove();\r\n\t\t\t        \t$('.page').hide();\r\n\t\t\t        \tif(data.length > 0){\r\n\t\t\t\t        \tfor(var n in data){\r\n\t\t\t\t        \t\t$('.page[data-n=\"'+data[n]+'\"]').show();\r\n\t\t\t\t        \t}\r\n\t\t\t\t        \r\n\t\t\t\t\t        visiblePages = $('.page:visible');\r\n\t\t\t\t        \tfor(var z = 0; z < visiblePages.length - 1; z++){\r\n\t\t\t\t        \t\tvar me = $(visiblePages[z]);\r\n\t\t\t\t        \t\tvar next = me.next('.page:visible');\r\n\t\t\t\t        \t\tc = parseInt(me.attr('data-n'),10);\r\n\t\t\t\t        \t\tn = parseInt(next.attr('data-n'),10);\r\n\t\t\t\t        \t\tif(n != c + 1){\r\n\t\t\t\t        \t\t\tme.after('<div class=\"separator\">•••</div>');\t\r\n\t\t\t\t        \t\t}\r\n\t\t\t\t        \t}\r\n\t\t\t\t        \t\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$('.page').show();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t        \tREF.highlight();\r\n\t\t\t        }\r\n\t\t\t       \r\n\t\t\t    });\t\r\n\t\t  }else{\r\n\t\t  \tREF.highlight();\r\n\t\t  \t$('.separator').remove();\r\n\t\t  \t$('.page').show();\r\n\t\t  }\r\n\t\t\t\r\n\t\t\t\r\n\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n};\r\n\r\nvar TOC = {\r\n\tpage : null,\r\n\t\r\n\tinit : function() {\r\n\t\t\r\n\t\tTOC.goPage(1);\r\n\t\t\r\n\t\t$(document).on('click','a.prev',TOC.prev);\r\n\t\t$(document).on('click','a.next',TOC.next);\r\n\t\t\r\n\t\t$('#goPage').change(function(){\r\n\t\t\tn = parseInt($(this).val());\r\n\t\t\tif(n !== TOC.page){\r\n\t\t\t\tTOC.goPage(n);\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t\t$(document).on('keyup','.author input.name' ,function(){\r\n\t\t\tvar dropdown = $(this).closest('td').find('.authorDropdown');\r\n\t\t\tvar val = $(this).val();\r\n\t\t\tdropdown.html('');\r\n\t\t\tif(val.length >=3){\r\n\t\t\t\t$.ajax({\r\n\t\t\t        url: \"/search/authors/\"+encodeURI(val),\r\n\t\t\t        type: \"GET\",\r\n\t\t\t        dataType: \"html\",\r\n\t\t\t        success: function (data) {\r\n\t\t\t            dropdown.html(data);\r\n\t\t\t        }\r\n\t\t\t    });\t\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t$(document).on('click', '.authorDropdown ul.bdb li', function(){\r\n\t\t\tvar parent = $(this).closest('td');\r\n\t\t\tvar input = parent.find('input.name');\r\n\t\t\tvar viaf = parent.find('input.viaf');\r\n\t\t\tinput.val($(this).text());\r\n\t\t\tviaf.val('');\r\n\t\t\tparent.find('.authorDropdown').html('');\r\n\t\t});\r\n\r\n\r\n\t\t$(document).on('click', '.authorDropdown ul.viaf li:not(.load)', function(){\r\n\t\t\tvar parent = $(this).closest('td');\r\n\t\t\tvar input = parent.find('input.name');\r\n\t\t\tvar viaf = parent.find('input.viaf');\r\n\t\t\tinput.val($(this).text());\r\n\t\t\tviaf.val($(this).attr('data-viafid'));\r\n\t\t\tparent.find('.authorDropdown').html('');\r\n\t\t});\r\n\r\n\t\t$(document).on('click', 'ul.viaf li.load', function(){\r\n\t\t\tvar input = $(this).closest('td').find('input.name');\r\n\t\t\t\r\n\t\t\tvar ul = $(this).closest('ul');\r\n\t\t\t$.ajax({\r\n\t        \turl: \"/search/viafAuthors/\"+encodeURI(input.val()),\r\n\t        \ttype: \"GET\",\r\n\t        \tdataType: \"html\",\r\n\t        \tsuccess: function (data) {\r\n\t        \t    ul.html(data);\r\n\t        \t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t},\r\n\t\r\n\tprev : function() {TOC.goPage(TOC.page-2);},\r\n\tnext : function() {TOC.goPage(TOC.page+2);},\r\n\tgoPage : function(n) {\r\n\t\tif(n % 2 == 0) n--;\r\n\r\n\t\tnbPage = parseInt($('body').attr('data-pagecount'),10);\r\n\t\tbid = $('body').attr('data-bid');\r\n\t\tissue = $('body').attr('data-issue');\r\n\r\n\t\tif(n < 1 || n > nbPage)\r\n\t\t\treturn;\r\n\t\t\r\n\t\tTOC.page = n;\r\n\t\t$('#goPage').val(TOC.page);\r\n\r\n\t\tleft = n;\r\n\t\tright = n+1;\t\r\n\t\tif(right > nbPage) right = null;\r\n\t\t\t\r\n\t\t$('#openseadragon_left').html('');\r\n\t\t$('#openseadragon_right').html('');\t\r\n\t\t\t\r\n\t\tif(left !== null){\r\n\t\t\tvar viewerL = OpenSeadragon({\r\n\t        \tid: 'openseadragon_left',\r\n\t       \t \tprefixUrl: \"/i/openseadragon/\",\r\n\t        \ttileSources: \"http://dhlabsrv4.epfl.ch/iiif_lbc/\"+bid+\"::\"+issue+\"::\"+left+\"/info.json\",\r\n\t        \tzoomPerScroll: 1.5,\r\n\t        \tshowNavigationControl: false,\r\n\t        \timmediateRender: true\r\n\t    \t});\t\t\t\r\n\t    \t$('.leftPg').html(left);\r\n\t\t}\r\n\t\tif(right !== null){\r\n\t\t\tvar viewerR = OpenSeadragon({\r\n\t        \tid: 'openseadragon_right',\r\n\t       \t \tprefixUrl: \"/i/openseadragon/\",\r\n\t        \ttileSources: \"http://dhlabsrv4.epfl.ch/iiif_lbc/\"+bid+\"::\"+issue+\"::\"+right+\"/info.json\",\r\n\t        \tzoomPerScroll: 1.5,\r\n\t        \tshowNavigationControl: false,\r\n\t        \timmediateRender: true\r\n\t    \t});\t\t\r\n\t    \t$('.rightPg').html(right);\t\r\n\t\t}\r\n\t\t\r\n\t\tif(left == 1){\r\n\t\t\t$('a.prev').hide();\t\r\n\t\t}else{\r\n\t\t\t$('a.prev').show();\t\t\r\n\t\t}\r\n\r\n\t\tif(right == nbPage || left == nbPage){\r\n\t\t\t$('a.next').hide();\t\r\n\t\t}else{\r\n\t\t\t$('a.next').show();\t\t\r\n\t\t}\r\n\t\t\r\n\t\t\t\r\n\t}\r\n\t\r\n\t\r\n}\r\n\r\n\r\n\r\n$(document).ready(LBC.init);\r\n"]}